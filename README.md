配置ndk
屏幕快照 2016-09-18 下午10.28.15.png

打开Project的gradle.properties文件，添加：android.useDeprecatedNdk=true

新建一个NativeUtils的Java方法，增加native方法
/**
 * 创建者：wanglei
 * <p>时间：16/9/18  20:16
 * <p>类描述：
 * <p>修改人：
 * <p>修改时间：/Users/wanglei/Downloads/wwww_3/MyApplication/app/src/main/java
 * <p>修改备注：mydemo_1.myapplication.NativeUtils
 * cd ..    返回上一级
 * cd /     返回根目录
 * javah -d ../jni mydemo_1.myapplication.NativeUtils
 *  todo 必须要进入到当前NativeUtils所在的Java目录在执行才能用
 */
public class NativeUtils {
    static {
        System.loadLibrary("NativeExample");
    }

    public static native String getStr();
    public static native String getStr(String str);
}
执行Build->Make Project方法

这里写图片描述

执行完这一步后，我们会在项目的app\build\intermediates\classes\debug路径下发现编译成功的项目class文件
这里写图片描述
其中NativeUtils.class文件我们会用到

命令行生成com_jni_example_NativeUtils.h头文件

打开Android studio Terminal界面，打开步骤是View->Tool Windows->Terminal
这里写图片描述
输入命令cd app/src/main/java进入app java路径下


在输入命令javah -d ../jni mydemo_1.myjnidemo_1.NativeUtils（mydemo_1.myjnidemo_1包名 	后面的NativeUtils是Java类名）

执行完命令后，我们会在app Module的src/main路径下看到jni文件夹，里面有自动生成的.h文件，该文件不需要去编辑
这里写图片描述

实现.h中的方法，拷贝自动生成的.h方法，到jni里，并重命名为main.c，并编写main.c中的代码，实现native方法

/* DO NOT EDIT THIS FILE - it is machine generated */
#include <jni.h>
/* Header for class mydemo_1_myapplication_NativeUtils */

#ifndef _Included_mydemo_1_myapplication_NativeUtils
#define _Included_mydemo_1_myapplication_NativeUtils
#ifdef __cplusplus
extern "C" {
#endif
/*
 * Class:     mydemo_1_myapplication_NativeUtils
 * Method:    getStr
 * Signature: ()Ljava/lang/String;
 */
JNIEXPORT jstring JNICALL Java_mydemo_11_myapplication_NativeUtils_getStr__
        (JNIEnv *env, jclass jobj) {
    return (*env)->NewStringUTF(env, "我是写在jni中的字");
}

/*
 * Class:     mydemo_1_myapplication_NativeUtils
 * Method:    getStr
 * Signature: (Ljava/lang/String;)Ljava/lang/String;
 */
JNIEXPORT jstring JNICALL Java_mydemo_11_myapplication_NativeUtils_getStr__Ljava_lang_String_2
        (JNIEnv *env, jclass jobj, jstring str) {
    return str;
}

#ifdef __cplusplus
}
#endif
#endif


打开app Module的build.gradle文件，在defaultConfig节点里添加一下ndk代码,其中moduleName中的字符串与NativeUtils.java中的System.loadLibrary("NativeExample”);对应

android {
    compileSdkVersion 24
    buildToolsVersion "24.0.2"

    defaultConfig {
        applicationId "mydemo_1.myapplication"
        minSdkVersion 15
        targetSdkVersion 24
        versionCode 1
        versionName "1.0"

        ndk {
            moduleName "NativeExample"
            ldLibs "log", "z", "m"
            abiFilters "armeabi", "armeabi-v7a", "arm64-v8a","mips","mips64","x86","x86_64"
        }

    }
    buildTypes {
        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
        }
    }
}
同步操作Tools->Android->Sync Project with Gradle Files
这里写图片描述


生成SO文件

同步完成后，执行Build->Rebuild Project就可以编译出SO文件了
这里写图片描述
此时，我们会在项目的app\build\intermediates\ndk\debug\lib路径下发现生成的SO文件
屏幕快照 2016-09-18 下午10.38.50.png

使用：

直接在新工程中的main下面建立一个文件夹比如jniLibs，把上面生成的这些包导入，在在java文件夹中导入上面编写的NativeUtils的Java文件

在Android中如下调用

public void but(View view) {
    String str = NativeUtils.getStr();
    Log.e("MainActivity", str);
    Toast.makeText(this, str, Toast.LENGTH_SHORT).show();
}
以上生成的so包的，在使用的时，Java文件夹下的包名比如和生成so包时的那个包名相同，否则不能使用屏幕快照 2016-09-18 下午10.50.09.png





